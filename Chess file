import random
import chess
import chess.pgn
import time


PUZZLES = {
    "easy": [
        {
            "fen": "6k1/5ppp/8/8/8/7Q/6PP/6K1 w - - 0 1",
            "solution": "Qxh7+"
        }
    ],
    "medium": [
        {
            "fen": "r1bqkbnr/pppp1ppp/2n5/4p3/4P3/2N2N2/PPPP1PPP/R1BQKB1R w KQkq - 2 3",
            "solution": "Bc4"
        }
    ],
    "hard": [
        {
            "fen": "4rrk1/pp1n1ppp/2p1bn2/q2p4/3P4/2P1PN2/PP1NBPPP/R2Q1RK1 w - - 0 1",
            "solution": "c4"
        }
    ]
}


def print_board(board: chess.Board) -> None:
    """Display the chess board in a readable ASCII format."""
    print("\n")
    print(board)
    print("\n")


def get_user_move() -> str:
    """Prompt user for a chess move."""
    return input("Enter your move (e.g. Qh7+, Bc4, c4): ").strip()


def play_puzzle(difficulty: str) -> bool:
    """Run a single puzzle round."""
    puzzle = random.choice(PUZZLES[difficulty])
    board = chess.Board(puzzle["fen"])

    print(f"\nğŸ§  Difficulty: {difficulty.upper()}")
    print_board(board)

    start_time = time.time()
    user_move = get_user_move()
    elapsed = round(time.time() - start_time, 2)

    if user_move == puzzle["solution"]:
        print(f"âœ… Correct! Time taken: {elapsed}s")
        return True

    print(f"âŒ Wrong. Correct move was: {puzzle['solution']}")
    return False


def choose_difficulty() -> str:
    """Allow player to select difficulty."""
    print("\nChoose Difficulty:")
    print("1. Easy")
    print("2. Medium")
    print("3. Hard")

    choice = input("Select (1-3): ").strip()

    return {
        "1": "easy",
        "2": "medium",
        "3": "hard"
    }.get(choice, "easy")


def main() -> None:
    """Main game loop."""
    print("\nâ™Ÿï¸  Brain Chess â€“ Corporate Edition")
    print("Short chess puzzles to refresh your mind.\n")

    score = 0
    rounds = 0

    while True:
        difficulty = choose_difficulty()
        correct = play_puzzle(difficulty)

        rounds += 1
        score += int(correct)

        print(f"\nğŸ“Š Score: {score}/{rounds}")

        again = input("\nPlay another puzzle? (y/n): ").lower().strip()
        if again != "y":
            break

    print("\nğŸ‘‹ Thanks for playing. Stay sharp!")


if __name__ == "__main__":
    main()
